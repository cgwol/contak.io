import{s as c,u as v,a as D,b as S,r as U,j as h,F as N,c as o,N as E,t as C}from"./index-88cc3bb7.js";const P=45,q=async()=>{const{data:{user:r},error:t}=await c.auth.getUser();if(t)throw t;const{data:e,error:i}=await c.from("my_profile").select().maybeSingle();if(i)throw i;if(!e)return{my_profile:null,auth:r,profile_pictures:null};let l="";if(e.profile_pictures&&e.profile_pictures.length){const{data:{signedUrl:d},error:p}=await c.storage.from("profile_pictures").createSignedUrl(e.profile_pictures[0],P,{transform:{width:600,height:600}});if(p)throw p;l=d}else console.log(`No profile pictures for ${r.id}`);return{my_profile:e,auth:r,profile_pictures:l}},k=(r,t)=>{const e=t.split("."),i=e[e.length-1];if(r){const l=r[e[0]];return{key:i,value:l?e.slice(1).reduce((d,p)=>d[p],l):""}}return{key:i,value:""}},I=(r,t,e)=>{const i=t.split("."),l=i[i.length-1],d=i.slice(0,i.length-1).reduce((p,n)=>p?p[n]:p[n]={},r);return d[l]=e,{key:l,parent:d,value:e,path:t}},M=[{path:"my_profile.username",type:"text"},{path:"my_profile.first_name",type:"text"},{path:"my_profile.last_name",type:"text"},{path:"auth.email",type:"email"},{path:"my_profile.birthday",type:"datetime-local"},{path:"my_profile.gender",type:"dropdown",dropdownValues:["Female","Male","Non-Binary"]},{path:"my_profile.user_type",type:"dropdown",dropdownValues:["User","Creator"]}],O=async r=>{if(!r)return r;const{my_profile:t,auth:e}=r,i=["profile_pictures"],l={...t,user_id:e.id,birthday:t.birthday?C(t.birthday):null,deleted_at:t.deleted_at?C(t.deleted_at):"infinity"};if(i.forEach(n=>delete l[n]),t.user_id){const{error:n,data:g}=await c.from("my_profile").update(l).eq("user_id",e.id);if(n)throw n}else{const{error:n,data:g}=await c.from("my_profile").insert(l);if(n)throw n}const{error:d,data:p}=await c.auth.updateUser({email:e.email});if(d)throw d},F=async r=>{const{error:t}=await c.from("my_profile").delete().eq("user_id",r);if(t)throw t},L=async r=>{const{error:t,data:e}=await c.from("my_profile").update({deleted_at:"infinity"}).eq("user_id",r);if(t)throw t};function R(){const r=v(),t=D();S();const[e,i]=U.useState(r),l=s=>{const[a,f]=s.target.name.split(".");e[a]??(e[a]={}),I(e,s.target.name,s.target.value),i({...e})},d=s=>{e.my_profile.deleted_at=new Date().toISOString(),i({...e}),F(e.my_profile.user_id).then(()=>{c.auth.signOut().then(()=>t("/"))})},p=s=>{e.my_profile.deleted_at="infinity",i({...e}),L(e.my_profile.user_id)},n=e!=null&&e.my_profile!=null,g=!n||new Date(e.my_profile.deleted_at)<=new Date,w=e.profile_pictures&&e.profile_pictures.length,x="bg-neutral-700 txt-neutral-100 fs-s";return h(N,{children:[o(E,{}),o("h1",{className:"font-family fs-xxl fw-800",style:{maxWidth:"min(100%, 900px)",textAlign:"Left"},children:"Profile Overview"}),h("div",{className:"flex-column flex-center",children:[o("div",{children:o("button",{className:"rounded-btn bg-neutral-100 txt-neutral-800",style:{padding:"1em"},onClick:s=>O(e).catch(a=>console.log(a)),children:"Save"})}),h("div",{children:[w?o("img",{src:e.profile_pictures,alt:"my profile picture",style:{maxWidth:"600px",maxHeight:"600px"}}):o("h4",{children:"Upload Profile Image"}),o("br",{}),o("input",{type:"file",accept:"image/*",onInput:s=>{console.log(s);const a=s.target.files[0];if(!a)return;const f=`${e.my_profile.user_id}/${a.name}`;c.storage.from("profile_pictures").upload(f,a,{upsert:!0}).then(({data:m,error:_})=>{if(_)throw _;return c.storage.from("profile_pictures").createSignedUrl(f,P,{transform:{width:600,height:600}}).then(({data:u,error:y})=>{if(y)throw y;e.my_profile.profile_pictures=f,i({...e,profile_pictures:u.signedUrl})})}).catch(m=>console.error(m))}}),w&&o("button",{onClick:s=>{const a=e.my_profile.profile_pictures;c.storage.from("profile_pictures").remove(Array.isArray(a)?a:[a]).then(({data:f,error:m})=>{if(m)throw m;e.my_profile.profile_pictures="",i({...e,profile_pictures:""})}).catch(f=>console.log(f))},children:"Delete Profile Picutre"})]})]}),h("div",{className:"fs-s",style:{padding:"0 4em"},children:[M.map(s=>({...s,...k(e,s.path)})).map(({key:s,value:a,path:f,type:m,dropdownValues:_})=>h("div",{className:"grid",style:{gridTemplateColumns:"repeat(auto-fit, minmax(300px, 1fr))",padding:"1.5em 2em",borderColor:"var(--bg-neutral-300)",borderBottom:"2px solid"},children:[o("p",{style:{marginLeft:"3em"},children:s.split("_").map(u=>u[0].toUpperCase()+u.substring(1)).join(" ")}),(()=>{switch(m){case"dropdown":return o("select",{name:f,onChange:l,defaultValue:a??_[0],children:_.map(u=>o("option",{value:u,children:u},u))});default:{if(m.includes("date")){const u=new Date(a),y=!isNaN(u)&&a,b=y&&u.toISOString();return o("input",{className:x,onChange:l,name:f,type:m,value:y?b.substring(0,b.length-1):""})}return o("input",{className:x,onChange:l,name:f,type:m,value:a??""})}}})()]},s)),n&&o("div",{className:"flex-center flex-column",children:g?h(N,{children:[o("button",{className:"rounded-btn bg-green-100",onClick:p,style:{padding:"2em"},children:"Restore Profile"}),h("p",{children:["Deleted at ",new Date(e.my_profile.deleted_at).toLocaleString()]})]}):o("button",{className:"rounded-btn bg-red-100",onClick:d,style:{padding:"2em"},children:"Delete Profile"})})]})]})}const A=R;export{A as Component,q as loader};
