import{r as d,j as g,c as f,d as y,f as v,e as b,s as p}from"./index-7300ae23.js";const U=(t,{volume:n=1,playbackRate:r=1,autoPlay:a=!1})=>{const[i,s]=d.useState(a),e=d.useMemo(()=>new Audio(t),[t]),l=d.useRef(!1),c=()=>{if(l.current){e.play();return}e.src=t,e.addEventListener("canplay",()=>e.play(),{once:!0})};return d.useEffect(()=>{e.volume=n},[n,e]),d.useEffect(()=>{e.playbackRate=r},[r,e]),d.useEffect(()=>{a&&e.play();function o(){s(!this.paused&&!this.ended)}function u(){l.current=!1}function m(){l.current=!0}return e.addEventListener("play",o),e.addEventListener("pause",o),e.addEventListener("ended",o),e.addEventListener("loadstart",u),e.addEventListener("canplay",m),()=>{e.removeEventListener("play",o),e.removeEventListener("pause",o),e.removeEventListener("ended",o),e.removeEventListener("loadstart",u),e.removeEventListener("canplay",m)}},[e]),{audio:e,isPlaying:i,play:c}},_=({track:t})=>{const{track_name:n,track_creators:r,signedUrl:a}=t,{audio:i,isPlaying:s}=U(a,{});return g("div",{className:"grid",style:{gridTemplateColumns:"1fr 1fr 2fr",columnGap:"1em"},children:[f("button",{onClick:()=>s?i.pause():i.play(),disabled:!a,children:f(y,{icon:s?v:b})}),f("p",{children:n}),f("p",{children:r==null?void 0:r.map(e=>`${e.first_name} ${e.last_name}`).join(", ")})]})},h=async t=>{const n=t.map(i=>{var s;return(s=i.audio_files)==null?void 0:s[0]}).filter(i=>i);if(!n.length)return{signedUrls:[],type:"tracks"};const{data:r,error:a}=await p.storage.from("tracks").createSignedUrls(n,60*5);if(a)throw a;return{signedUrls:r,type:"tracks"}},E=async t=>{const{data:n,error:r}=await p.storage.from("album_covers").createSignedUrls(t.album_covers,300);if(r)throw r;return{signedUrls:n,album_id:t.album_id}},w=async t=>{const n=[];for(const s of t)n.push(E(s)),Array.isArray(s.album_tracks)&&s.album_tracks.length&&n.push(h(s.album_tracks));const r=await Promise.allSettled(n),a=new Map,i=new Map;for(const s of r){if(s.status!=="fulfilled"){console.warn(`Error loading signed resource urls: ${s.reason}`);continue}if("album_id"in s.value){const{album_id:e,signedUrls:l}=s.value,c=a.get(e);if(Array.isArray(c))for(const o of l)c.push(o);else a.set(e,l??[])}else if(s.value.type==="tracks"){const e=s.value.signedUrls;for(const l of e){const c="/object/sign/tracks/",o=l.signedUrl.indexOf(c)+c.length,u=+l.signedUrl.substring(o,l.signedUrl.indexOf("/",o));i.set(u,l.signedUrl)}}else throw new Error(`Unknown resolved promise ${s}`)}return{albumCovers:a,trackFiles:i}};export{_ as A,w as f};
